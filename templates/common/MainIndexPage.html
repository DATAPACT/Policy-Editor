    {% extends 'base.html' %}
    {%load static %}

    {% block inpagecss %}
/* Base styles */
/* https://www.color-hex.com/color-palette/1057703 */

:root {
  /* --primary-color: #1976d2;
  --secondary-color: #2196f3;
  --tertiary-color: #64b5f6; 
  --primary-color: #aaaaaa;
  --secondary-color: #bbbbbb;
  --tertiary-color: #cccccc;*/
  --primary-color: #72bcd4;
  --secondary-color: #86c5da;
  --tertiary-color: #99cfe0;
  --light-gray: #f5f7fa;
  --hover-color: #e3f2fd;
  --public-color: #66bb6a;
  --private-color: #5c6bc0;
  --shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
  --font-family: 'Segoe UI', Arial, sans-serif;
  --border-radius: 6px;
  --transition: all 0.25s ease;
  
  /*--primary-color_ontol: #d27519;
  --secondary-color_ontol: #f37e21;
  --tertiary-color_ontol: #f6a564;
  --primary-color_ontol: #aaaaaa;
  --secondary-color_ontol: #bbbbbb;
  --tertiary-color_ontol: #cccccc;*/
  --primary-color_ontol: #72bcd4;
  --secondary-color_ontol: #86c5da;
  --tertiary-color_ontol: #99cfe0;
}
 
/* Navigation list styles */
ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}
 
ul li a {
  display: block;
  width: 100%;
  text-decoration: none;
  padding: 10px;
  transition: background-color 0.2s ease;
  border-radius: 4px;
}
 
ul li a:hover {
  background-color: var(--hover-color);
}

/* Main control wrapper for index */
.control_main_index_wrapper {
    width: 70%;
	display: block;
    margin-left: auto;
    margin-right: auto;
}
 
/* Form elements */
.form-select {
  color: black;
  background-color: white;
  padding: 8px;
  border-radius: 4px;
  border: 1px solid #ddd;
}
 
/* Public and private styles */
.public a {
  background: linear-gradient(to bottom right, var(--public-color), #4caf50);
  color: white;
  font-weight: 500;
  border-radius: var(--border-radius);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
  transition: var(--transition);
}
 
.public a:hover {
  background: linear-gradient(to bottom right, #4caf50, var(--public-color));
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
}
 
.private a {
  background: linear-gradient(to bottom right, var(--private-color), #3f51b5);
  color: white;
  font-weight: 500;
  border-radius: var(--border-radius);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
  transition: var(--transition);
}
 
.private a:hover {
  background: linear-gradient(to bottom right, #3f51b5, var(--private-color));
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
}
 
/* Grid container styles */
.container2 {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  background-color: var(--primary-color);
  #padding: 18px;
  padding: 9px;
  border-radius: var(--border-radius);
  #margin-bottom: 25px;
  margin-bottom: 0px;
  box-shadow: var(--shadow);
  gap: 10px;
}
 
.container2 > div {
  background-color: var(--light-gray);
  border: none;
  padding: 12px;
  font-size: 15px;
  text-align: center;
  border-radius: calc(var(--border-radius) - 2px);
  transition: var(--transition);
}

.container2_ontol {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  background-color: var(--primary-color_ontol);
  #padding: 18px;
  padding: 9px;
  border-radius: var(--border-radius);
  #margin-bottom: 25px;
  margin-bottom: 0px;
  box-shadow: var(--shadow);
  gap: 10px;
}
 
.container2_ontol > div {
  background-color: var(--light-gray);
  border: none;
  padding: 12px;
  font-size: 15px;
  text-align: center;
  border-radius: calc(var(--border-radius) - 2px);
  transition: var(--transition);
}
 
/* Grid header styles */
.grid-head-wrapper {
  display: contents;
}
 
.grid-head-wrapper > .grid-head-item {
  background: linear-gradient(to bottom, var(--secondary-color), var(--tertiary-color));
  color: white;
  font-size: 18px;
  font-weight: 600;
  #padding: 14px 10px;
  padding: 7px 5px;
  border-bottom: 2px solid var(--primary-color);
  text-shadow: 0 1px 1px rgba(0,0,0,0.1);
  letter-spacing: 0.5px;
  border-radius: calc(var(--border-radius) - 2px);
}

.grid-head-wrapper_ontol {
  display: contents;
}
 
.grid-head-wrapper_ontol > .grid-head-item_ontol {
  background: linear-gradient(to bottom, var(--secondary-color_ontol), var(--tertiary-color_ontol));
  color: white;
  font-size: 18px;
  font-weight: 600;
  #padding: 14px 10px;
  padding: 7px 5px;
  border-bottom: 2px solid var(--primary-color_ontol);
  text-shadow: 0 1px 1px rgba(0,0,0,0.1);
  letter-spacing: 0.5px;
  border-radius: calc(var(--border-radius) - 2px);
}

/* Grid container styles */
.container3 {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  background-color: var(--primary-color);
  padding: 18px;
  
  border-radius: var(--border-radius);
  margin-bottom: 25px;
  box-shadow: var(--shadow);
  #gap: 10px;
}
 
.container3 > div {
  background-color: var(--light-gray);
  border: none;
  padding: 12px;
  font-size: 15px;
  text-align: center;
  border-radius: calc(var(--border-radius) - 2px);
  transition: var(--transition);
}

.container3_ontol {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  background-color: var(--primary-color);
  padding: 18px;
  
  border-radius: var(--border-radius);
  margin-bottom: 25px;
  box-shadow: var(--shadow);
  #gap: 10px;
}
 
.container3_ontol > div {
  background-color: var(--light-gray);
  border: none;
  padding: 12px;
  font-size: 15px;
  text-align: center;
  border-radius: calc(var(--border-radius) - 2px);
  transition: var(--transition);
}
 
/* Grid row styles */
.grid-row-wrapper {
  display: contents;
}
 
.grid-row-wrapper > .grid-item {
  background: white;
  font-size: 20px;
  padding: 12px 10px;
  border-bottom: 1px solid #e0e0e0;
  transition: var(--transition);
}
 
.grid-row-wrapper:hover > .grid-item {
  background-color: var(--hover-color);
  transform: translateY(-2px);
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.grid-row-wrapper_ontol {
  display: contents;
}
 
.grid-row-wrapper_ontol > .grid-item {
  background: white;
  font-size: 20px;
  padding: 12px 10px;
  border-bottom: 1px solid #e0e0e0;
  transition: var(--transition);
}
 
.grid-row-wrapper_ontol:hover > .grid-item {
  background-color: var(--hover-color);
  transform: translateY(-2px);
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
 
/* Menu Bar Styling */
.menu-bar {
  display: flex;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  #padding: 14px 20px;
  padding: 7px 10px;
  font-family: var(--font-family);
  box-shadow: var(--shadow);
  border-radius: var(--border-radius);
  align-items: center;
  justify-content: space-between;
  #margin-bottom: 20px;
  margin-bottom: 10px;
}

.menu-bar_ontol {
  display: flex;
  background: linear-gradient(135deg, var(--primary-color_ontol), var(--secondary-color_ontol));
  #padding: 14px 20px;
  padding: 7px 10px;
  font-family: var(--font-family);
  box-shadow: var(--shadow);
  border-radius: var(--border-radius);
  align-items: center;
  justify-content: space-between;
  #margin-bottom: 20px;
  margin-bottom: 10px;
}
 
.menu-text-bar {
  background: linear-gradient(135deg, var(--secondary-color),var(--tertiary-color));
  #padding: 12px 20px;
  padding: 6px 10px;
  font-family: var(--font-family);
  box-shadow: var(--shadow);
  font-size: 25px;
  text-align: center;
  color: white;
  border-radius: var(--border-radius);
  #margin-bottom: 20px;
  margin-bottom: 10px;
  letter-spacing: 0.5px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.15);
}

.menu-text-bar_ontol {
  background: linear-gradient(135deg, var(--secondary-color_ontol), var(--tertiary-color_ontol));
  #padding: 12px 20px;
  padding: 6px 10px;
  font-family: var(--font-family);
  box-shadow: var(--shadow);
  font-size: 25px;
  text-align: center;
  color: white;
  border-radius: var(--border-radius);
  #margin-bottom: 20px;
  margin-bottom: 10px;
  letter-spacing: 0.5px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.15);
}
 
.menu-item {
  position: relative;
  margin: 0 20px;
  color: white;
  font-size: 16px;
  cursor: pointer;
  user-select: none;
  #padding: 8px 12px;
  padding: 4px 6px;
  border-radius: var(--border-radius);
  transition: var(--transition);
}

.menu-item_ontol {
  position: relative;
  margin: 0 20px;
  color: white;
  font-size: 16px;
  cursor: pointer;
  user-select: none;
  #padding: 8px 12px;
  padding: 4px 6px;
  border-radius: var(--border-radius);
  transition: var(--transition);
}
 
.menu-item:hover {
  background-color: rgba(255, 255, 255, 0.15);
}
 
.menu-item span {
  transition: var(--transition);
  position: relative;
}
 
.menu-item span:hover {
  text-decoration: none;
}
 
.menu-item span:after {
  content: '';
  position: absolute;
  width: 0;
  height: 2px;
  bottom: -4px;
  left: 0;
  background-color: white;
  transition: var(--transition);
}
 
.menu-item:hover span:after {
  width: 100%;
}
 
/* Button styles */
.menubar-button {
  background: linear-gradient(to bottom, var(--secondary-color), var(--primary-color));
  font-family: var(--font-family);
  font-size: 18px;
  box-shadow: var(--shadow);
  color: white;
  border: none;
  #padding: 10px 20px;
  padding: 5px 10px;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  z-index: 1;
}

.menubar-button#compareTwoPolicies {
  background: linear-gradient(to bottom, var(--secondary-color), var(--primary-color));
  font-family: var(--font-family);
  font-size: 18px;
  box-shadow: var(--shadow);
  color: white;
  border: none;
  #padding: 10px 20px;
  padding: 5px 10px;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  z-index: 1;
  
  left : 200px;
}

.menubar-button#logout {
  background: linear-gradient(to bottom, var(--secondary-color), var(--primary-color));
  font-family: var(--font-family);
  font-size: 18px;
  box-shadow: var(--shadow);
  color: white;
  border: none;
  #padding: 10px 20px;
  padding: 5px 10px;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  z-index: 1;
  
  left :300px;
  
}
 
.menubar-button:before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, rgba(255,255,255,0.1), transparent);
  transition: var(--transition);
  z-index: -1;
}
 
.menubar-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}
 
.menubar-button:hover:before {
  left: 100%;
}
 
.menubar-button:active {
  transform: translateY(1px);
}

.menubar-button_ontol {
  background: linear-gradient(to bottom, var(--secondary-color_ontol), var(--primary-color_ontol));
  font-family: var(--font-family);
  font-size: 18px;
  box-shadow: var(--shadow);
  color: white;
  border: none;
  #padding: 10px 20px;
  padding: 5px 10px;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  z-index: 1;
}
 
.menubar-button_ontol:before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, rgba(255,255,255,0.1), transparent);
  transition: var(--transition);
  z-index: -1;
}
 
.menubar-button_ontol:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}
 
.menubar-button_ontol:hover:before {
  left: 100%;
}
 
.menubar-button_ontol:active {
  transform: translateY(1px);
}
 
.grid-button {
  background: linear-gradient(to bottom, var(--secondary-color), var(--primary-color));
  font-family: var(--font-family);
  font-size: 13px;
  box-shadow: var(--shadow);
  width: 110px;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition);
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
}
 
.grid-button:before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, rgba(255,255,255,0.1), transparent);
  transition: var(--transition);
}
 
.grid-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}
 
.grid-button:hover:before {
  left: 100%;
}
 
.grid-button:active {
  transform: translateY(1px);
}
{% endblock %}
    {% block title %} Data Controller/Processor Home {% endblock %}
    {% block content %}
        <main id="main">
		    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
            
			
			<section id="faq" class="faq">
                    <header class="section-header">
                        <p>Welcome {{ user.username}} this is the Policy Editor</p>
                    </header>
					
					
					
					<body class="text-center">
					    <!-- <form>
                        
                            <label for="data"> You are currently logged into:</label><br>
						    <input id="data" type="text" name="data" value={{ request.get_host }}><br> -->
							<!-- <input id="data" type="text" name="data" value={{ request.get_host }}><br> -->
							
                            <!-- <input id="submit" type="submit" value="Submit"> -->
                        <!-- </form> -->
						<div class="container">
						    <p>Ver: Alpha - 0.2</p>
						</div>
						
						<div class="control_main_index_wrapper", id="control_main_index_wrapper">
						
						<div class="menu-text-bar">
						    Your Current Policies
							<a href="{% url 'logout' %}" class="menubar-button" id="logout"> Logout</a>
						</div>
						
						
						
					    <!-- START Menu Bar -->
                        <div class="menu-bar">
                       					
					        <!-- START new rule button -->
					        <!-- CMADD - These are left here to allow old code to reference -->
					        <!--         Should be removed in a fuller tidy up -->
                            <div class="menu-item">
                                                    
                                <!-- <button id="createNewPolicy" class="menubar-button" style="background-color:#34ebd8">Create New Policy</button>
								<button id="createNewPolicyFromUpload" class="menubar-button" style="background-color:#34ebd8">Create New Policy From Upload</button> -->
								<button id="createNewPolicy" class="menubar-button" >Create New Policy</button>
								<button id="createNewPolicyFromUpload" class="menubar-button" >Create New Policy From Upload</button>
								<button id="compareTwoPolicies" class="menubar-button" >Compare Two Policies</button>
                                
								<script type='text/javascript'>	
							       								   
								   $('#createNewPolicy').off('click').click(function() {
                                        var mode="create"
										
										selectedValues="... Create new policy ...."
										console.log("The selected value is " + selectedValues);
									
										var targetURL = "/update?policy=" + selectedValues + "&mode=" + mode;	
										window.open(targetURL,"_blank", "popup")
                                   });
								   
								   $('#createNewPolicyFromUpload').off('click').click(function() {
                                        var mode="create"
										
										selectedValues="... Create new policy via upload ...."
										console.log("The selected value is " + selectedValues);
									
										var targetURL = "/update?policy=" + selectedValues + "&mode=" + mode;	
										window.open(targetURL,"_blank", "popup")
                                   });
								   
								   $('#compareTwoPolicies').off('click').click(function() {
                                        
									
										var targetURL = "/compare" ;	
										window.open(targetURL,"_blank", "popup")
                                   });

								   
                                						   
						        </script>
                            </div>
					        <!-- END Edit Menu -->
                        </div>
				        <!-- END Menu Bar -->
						 
						<!-- CM2403 -->
						<div class="container2", id="policy_grid_head">
                            
                                <div class="grid-head-wrapper">
								    <div class="grid-head-item">Policy Name</div>
                                    <!-- <div class="grid-head-item">Policy Visibility</div> -->
									<div class="grid-head-item">Toggle Visibility</div>
								    <div class="grid-head-item">Edit this policy</div>
								    <div class="grid-head-item">Delete this policy</div>
								</div>
						</div>
						
						
						<div class="container3", id="policy_grid">		
								<div class="grid-row-wrapper" style="display: none">
								    <div class="grid-item" id="policyName">
									    <span id="policyNameSpan">ExamplePolicy_1</span>
									</div>
                                    <!-- <div class="grid-item" id="policyVisibility">
									    <span id="policyVisibilitySpan">Private</span>
									</div> -->
								    <div class="grid-item">
								        <button id="togglePolicy" class="grid-button" style="background-color:#34ebd8">Set Public</button>
								    </div>
                                    <div class="grid-item">
								        <button id="editPolicy" class="grid-button" style="background-color:#34ebd8">Edit Policy</button>
								    </div>
                                    <div class="grid-item">
								        <button id="deletePolicy" class="grid-button" style="background-color:#34ebd8">Delete Policy</button>
								    </div>
								</div>
                                				
																	
								<!-- <div class="grid-row-wrapper">
								    <div class="grid-item">Dummy_1</div>
                                    <div class="grid-item">Private</div>
								    <div class="grid-item">
								        <button id="togglePolicy" class="grid-button" style="background-color:#34ebd8">Set Public</button>
								    </div>
                                    <div class="grid-item">
								        <button id="editPolicy" class="grid-button" style="background-color:#34ebd8">Edit Policy</button>
								    </div>
                                    <div class="grid-item">
								        <button id="deletePolicy" class="grid-button" style="background-color:#34ebd8">Delete Policy</button>
								    </div>
								</div>
								
                                <div class="grid-row-wrapper">
								    <div class="grid-item">Dummy_2</div>
                                    <div class="grid-item">Public</div>
								    <div class="grid-item">
								        <button id="togglePolicy" class="grid-button" style="background-color:#34ebd8">Set Private</button>
								    </div>
                                    <div class="grid-item">
								        <button id="editPolicy" class="grid-button" style="background-color:#34ebd8">Edit Policy</button>
								    </div>
                                    <div class="grid-item">
								        <button id="deletePolicy" class="grid-button" style="background-color:#34ebd8">Delete Policy</button>
								    </div>
								</div> -->
								
							<script type='text/javascript'>	
							    {% for SavedPol in SavedPols %}			       
							   
							        var $originalRow = $('.grid-row-wrapper').first();
                                    var $newRow = $originalRow.clone();
							        $newRow.css("display", "contents");
								   
								    $newRow.find('#policyName span').text("{{ SavedPol.name }}");
								    ProtectionText="Unknown"
								    ToggleText="Unknown"
								    if ( {{ SavedPol.protection }} == 0 ){
								        ProtectionText='Public'
									    ToggleText='Private'
								    }
								    else{
								        ProtectionText='Private'
									    ToggleText='Public'
								    }
								    
									/* $newRow.find('#policyVisibility span').text(ProtectionText);
									
									if (ProtectionText == "Public"){
									    $newRow.find('#policyVisibility span').html("<i class='fa fa-eye' style='font-size:24px'></i>");
									} else {
									    $newRow.find('#policyVisibility span').html("<i class='fa fa-eye-slash' style='font-size:24px'></i>");
									}  */
									
								    $newRow.find('#togglePolicy').text("Set " + ToggleText);
									
									if (ProtectionText == "Public"){
									    $newRow.find('#togglePolicy').html("<i class='fa fa-eye' style='font-size:16px'></i>");
									} else {
									    $newRow.find('#togglePolicy').html("<i class='fa fa-eye-slash' style='font-size:16px'></i>");
									}
									
									$newRow.find('#editPolicy').html("<i class='fa fa-edit' style='font-size:16px'></i>");
									$newRow.find('#deletePolicy').html("<i class='fa fa-trash' style='font-size:16px'></i>");
								   
							        $newRow.appendTo('.container3'); 
								   
								   
								    $newRow.find('#editPolicy').off('click').click(function() {
                                         var mode="update"
										
										 selectedValues="{{ SavedPol.name }}"
										 console.log("The selected value is " + selectedValues);
									
										 var targetURL = "/update?policy=" + selectedValues + "&mode=" + mode;	
										 window.open(targetURL,"_blank", "popup")
                                    });
									
									$newRow.find('#deletePolicy').off('click').click(function() {
                                         var mode="delete"
										
										 selectedValues="{{ SavedPol.name }}"
										 console.log("The selected value is " + selectedValues);
									
										 var targetURL = "/update?policy=" + selectedValues + "&mode=" + mode;	
										 window.open(targetURL,"_blank", "popup")
                                    });
								   
								   
								   
								    
									$newRow.find('#togglePolicy').off('click').click(function() {
	   
	                                    selectedValues="{{ SavedPol.name }}"
                                        console.log("The ontology to make public is  " + selectedValues);
	                                    	 
	                                    let check_rules=[];
	
	    
	                                    $.ajax({
                                           type: 'GET',
				
				
			
                                            url: '/organization/get_uploaded_rules/',  // Endpoint to fetch uploaded rules 
                                            success: function (response) {
                                                console.log("make public get uploaded AJAX call successful" );
                                                // Check if any rules exist
                                                if (response.odrls && response.odrls.length > 0) {
				                                    console.log("Processing the policy list " + response.odrls.length);
                                                    // Populate the list with ontologies
					                                response.odrls.forEach(function (policy) {
					                                    console.log("In make public returned items next " + policy.name + " : " + policy.id);
					        
                                                        check_rules.push({name: policy.name, id: policy.id} );
						                                console.log("In make public the length of the array is " + check_rules.length);	
                                                    });
					
					                                // This is here because .ajax is asynchronous so ensures that 
					                                //    global check_rules is only accessed after call completed
					                                usemakepublicCheckPols();
					
		
                    
                                                } else {
                                                    console.error('Error fetching policies in make public:', error);
                                                }

               
                                            },
                                                error: function (error) {
                                                console.error('Error fetching policies in make public:', error);
                                            }
                                        });
		
	                                    function usemakepublicCheckPols(){
	                                        console.log("AFTER AJAX in delete. The length of the array is " + check_rules.length);	
		                                    let policy_name_id = check_rules.find(policy_name_id => policy_name_id.name === selectedValues);
	                                        console.log("The policy id to toggle is " + policy_name_id.id);
	
	                                        makepublicPolicy(policy_name_id.id);
			
						
	                                    }
	   
        
                                    });
	
   
                                    // Make an policy public
                                    function makepublicPolicy(id) {
	      
	    
                                        fetch(`/organization/toggle_policy_api_visiblity/${id}/`, { method: 'POST', headers: {
                                                                   'X-CSRFToken': '{{ csrf_token }}', // Include CSRF token
                                                  } }) 
                                        .then(response => {
                                            if (response.ok) {
                                                console.log(response.statusText);
					                            /* alert(response.statusText); */
					                            window.location.href = (window.location.href.split('?')[0])
                                            } else { 
                                                console.error("Error toggling policy API visibility: ", response.statusText);
                                            }
                                        })
                                        .catch(error => {
                                            console.error("Error toggling policy API visibility: ", error);
                                        });
                                    }	

								   
                                {% endfor %}								   
						    </script>
                            
                        </div>


						<div class="menu-text-bar_ontol">
						    Your Current Ontologies
						</div>
						
					    <!-- START Menu Bar -->
                        <div class="menu-bar_ontol">
                       					
					        <!-- START new rule button -->
					        <!-- CMADD - These are left here to allow old code to reference -->
					        <!--         Should be removed in a fuller tidy up -->
                            <div class="menu-item_ontol">
                                                    
                                <!-- <button id="createNewPolicy" class="menubar-button" style="background-color:#34ebd8">Create New Policy</button>
								<button id="createNewPolicyFromUpload" class="menubar-button" style="background-color:#34ebd8">Create New Policy From Upload</button> -->
								<button id="createNewOntology" class="menubar-button_ontol" >Create New Ontology</button>
								
                                
								<script type='text/javascript'>	
							       								   
								   $('#createNewOntology').off('click').click(function() {
                                        var mode="create"
										
										selectedValues="... Add new ontology ...."
										console.log("The selected value is " + selectedValues);
									
										var targetURL = "/update_ontol?ontology=" + selectedValues + "&mode=" + mode;	
										window.open(targetURL,"_blank", "popup")
                                   });
								   
                                						   
						        </script>
                            </div>
					        <!-- END Edit Menu -->
                        </div>
				        <!-- END Menu Bar -->


						<!-- CM2403 -->
						<div class="container2_ontol", id="ontology_grid_head">
                            
                                <div class="grid-head-wrapper_ontol">
								    <div class="grid-head-item_ontol">Ontology Name</div>
                                    <!-- <div class="grid-head-item">Policy Visibility</div> -->
									<div class="grid-head-item_ontol">Toggle Visibility</div>
								    <div class="grid-head-item_ontol">Edit this ontology</div>
								    <div class="grid-head-item_ontol">Delete this ontology</div>
								</div>
						</div>
						
						
						<div class="container3_ontol", id="ontology_grid">		
								<div class="grid-row-wrapper_ontol" style="display: none">
								    <div class="grid-item" id="ontologyName">
									    <span id="policyNameSpan">ExampleOntology_1</span>
									</div>
                                    <!-- <div class="grid-item" id="policyVisibility">
									    <span id="policyVisibilitySpan">Private</span>
									</div> -->
								    <div class="grid-item">
								        <button id="toggleOntology" class="grid-button" style="background-color:#34ebd8">Set Public</button>
								    </div>
                                    <div class="grid-item">
								        <button id="editOntology" class="grid-button" style="background-color:#34ebd8">Edit Ontology</button>
								    </div>
                                    <div class="grid-item">
								        <button id="deleteOntology" class="grid-button" style="background-color:#34ebd8">Delete Ontology</button>
								    </div>
								</div>
                                				
																	
								<!-- <div class="grid-row-wrapper">
								    <div class="grid-item">Dummy_1</div>
                                    <div class="grid-item">Private</div>
								    <div class="grid-item">
								        <button id="togglePolicy" class="grid-button" style="background-color:#34ebd8">Set Public</button>
								    </div>
                                    <div class="grid-item">
								        <button id="editPolicy" class="grid-button" style="background-color:#34ebd8">Edit Policy</button>
								    </div>
                                    <div class="grid-item">
								        <button id="deletePolicy" class="grid-button" style="background-color:#34ebd8">Delete Policy</button>
								    </div>
								</div>
								
                                <div class="grid-row-wrapper">
								    <div class="grid-item">Dummy_2</div>
                                    <div class="grid-item">Public</div>
								    <div class="grid-item">
								        <button id="togglePolicy" class="grid-button" style="background-color:#34ebd8">Set Private</button>
								    </div>
                                    <div class="grid-item">
								        <button id="editPolicy" class="grid-button" style="background-color:#34ebd8">Edit Policy</button>
								    </div>
                                    <div class="grid-item">
								        <button id="deletePolicy" class="grid-button" style="background-color:#34ebd8">Delete Policy</button>
								    </div>
								</div> -->
								
							<script type='text/javascript'>	
							    {% for CustOnt in CustOntList %}			       
							   
							        var $originalRow_ontol = $('.grid-row-wrapper_ontol').first();
                                    var $newRow_ontol = $originalRow_ontol.clone();
							        $newRow_ontol.css("display", "contents");
								   
								    $newRow_ontol.find('#ontologyName span').text("{{ CustOnt.name }}");
								    ProtectionText="Unknown"
								    ToggleText="Unknown"
								    if ( {{ CustOnt.protection }} == 0 ){
								        ProtectionText='Public'
									    ToggleText='Private'
								    }
								    else{
								        ProtectionText='Private'
									    ToggleText='Public'
								    }
								    
									/* $newRow.find('#policyVisibility span').text(ProtectionText);
									
									if (ProtectionText == "Public"){
									    $newRow.find('#policyVisibility span').html("<i class='fa fa-eye' style='font-size:24px'></i>");
									} else {
									    $newRow.find('#policyVisibility span').html("<i class='fa fa-eye-slash' style='font-size:24px'></i>");
									}  */
									
								    $newRow_ontol.find('#toggleOntology').text("Set " + ToggleText);
									
									if (ProtectionText == "Public"){
									    $newRow_ontol.find('#toggleOntology').html("<i class='fa fa-eye' style='font-size:16px'></i>");
									} else {
									    $newRow_ontol.find('#toggleOntology').html("<i class='fa fa-eye-slash' style='font-size:16px'></i>");
									}
									
									$newRow_ontol.find('#editOntology').html("<i class='fa fa-edit' style='font-size:16px'></i>");
									$newRow_ontol.find('#deleteOntology').html("<i class='fa fa-trash' style='font-size:16px'></i>");
								   
							        $newRow_ontol.appendTo('.container3_ontol'); 
								   
								   
								    $newRow_ontol.find('#editOntology').off('click').click(function() {
                                         var mode="update"
										
										 selectedValues="{{ CustOnt.name }}"
										 console.log("The selected value is " + selectedValues);
									
										 var targetURL = "/update_ontol?ontology=" + selectedValues + "&mode=" + mode;	
										 window.open(targetURL,"_blank", "popup")
                                    });
									
									$newRow_ontol.find('#deleteOntology').off('click').click(function() {
                                         var mode="delete"
										
										 selectedValues="{{ CustOnt.name }}"
										 console.log("The selected value is " + selectedValues);
									
										 var targetURL = "/update_ontol?ontology=" + selectedValues + "&mode=" + mode;	
										 window.open(targetURL,"_blank", "popup")
                                    });
								   
								   
								   
								    
									$newRow_ontol.find('#toggleOntology').off('click').click(function() {
	   
	                                    selectedValues="{{ CustOnt.name }}"
                                        console.log("The ontology to make public is  " + selectedValues);
	                                    	 
	                                    let check_ontols=[];
	
	    
	                                    $.ajax({
                                           type: 'GET',
				
				
			
                                            url: '/organization/get_uploaded_ontologies/',  // Endpoint to fetch uploaded rules 
                                            success: function (response) {
                                                console.log("make public get uploaded AJAX call successful" );
                                                // Check if any rules exist
                                                if (response.ontologies && response.ontologies.length > 0) {
				                                    console.log("Processing the ontologies list " + response.ontologies.length);
                                                    // Populate the list with ontologies
					                                response.ontologies.forEach(function (ontol) {
					                                    console.log("In make public returned items next " + ontol.name + " : " + ontol.id);
					        
                                                        check_ontols.push({name: ontol.name, id: ontol.id} );
						                                console.log("In make public the length of the array is " + check_ontols.length);	
                                                    });
					
					                                // This is here because .ajax is asynchronous so ensures that 
					                                //    global check_rules is only accessed after call completed
					                                usemakepublicCheckOntols();
					
		
                    
                                                } else {
                                                    console.error('Error fetching policies in make public:', error);
                                                }

               
                                            },
                                                error: function (error) {
                                                console.error('Error fetching policies in make public:', error);
                                            }
                                        });
		
	                                    function usemakepublicCheckOntols(){
	                                        console.log("AFTER AJAX in delete. The length of the array is " + check_ontols.length);	
		                                    let ontol_name_id = check_ontols.find(ontol_name_id => ontol_name_id.name === selectedValues);
	                                        console.log("The ontology id to toggle is " + ontol_name_id.id);
	
	                                        makepublicOntology(ontol_name_id.id);
			
						
	                                    }
	   
        
                                    });
	
   
                                    // Make an policy public
                                    function makepublicOntology(id) {
	      
	    
                                        fetch(`/organization/toggle_ontology_api_visiblity/${id}/`, { method: 'POST', headers: {
                                                                   'X-CSRFToken': '{{ csrf_token }}', // Include CSRF token
                                                  } }) 
                                        .then(response => {
                                            if (response.ok) {
                                                console.log(response.statusText);
					                            /* alert(response.statusText); */
					                            window.location.href = (window.location.href.split('?')[0])
                                            } else { 
                                                console.error("Error toggling ontology API visibility: ", response.statusText);
                                            }
                                        })
                                        .catch(error => {
                                            console.error("Error toggling ontology API visibility: ", error);
                                        });
                                    }	

								   
                                {% endfor %}								   
						    </script>
                            
                        </div>
						
						</div>
	







						
						
					
					    <br>
                        <div class="container">
                            
							<p>Your current policies</p>
							<!-- CM0311 -->
							<p>(Green = Public, Blue = Private)</p>
							
                            <div class="container pt-3" style="width:700px;", onclick="ReadSelected()">
                                <select class="form-select" name="policy" id="policy" size="5" >					    
						            <option value="IGNORE" selected="selected">
                                        Select Policy
                                    </option>
									<option value="... Create new policy ....">
                                        ... Create new policy ....
                                    </option>
									<option value="... Create new policy via upload ....">
                                        ... Create new policy via upload ....
                                    </option>
							        {% for SavedPol in SavedPols %}
						                <!-- <option value= "{{ SavedPol }}"> </option> -->
							            <!-- <option value= "{% url 'update' %}">{{ SavedPol }} </option> -->
										<option value= "{{ SavedPol.name }}">{{ SavedPol.name }} </option>
						            {% endfor %}
							        
						        </select>
						        <br>
								
								<script type='text/javascript'>	
                                    var policyMenu=document.getElementById("policy");
	 
	                                policyMenu.onchange=function(){
									    console.log("On change fired ");
	                                    var userOption = this.options[this.selectedIndex];
		                                // window.alert("CLICK FOUND VIA ON CHANGE");
		                                if ( userOption.value != "IGNORE" ){
		                                    /* For future use if required
											   Not used currently as this will not detect click on same value twice in a row */
		                                }
		 
	                                } 
	
                                </script>
								
								{% csrf_token %}
								
								<script>
								    function ReadSelected(){
									   
                                       var selectedValues = $("#policy").val();
									   
									   console.log("On click fired ");
									   
                                       if ( selectedValues != "IGNORE" ){
									       
										   // window.alert("Selected values ReadSelected are " + selectedValues);
										   
										   /* SEND DATA PACKET TO THE SERVER WITH REQUIRED POLICY NAME */
										   
										   var targetURL = "/testview";	
										   const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
										   // https://stackoverflow.com/questions/43606056/proper-django-csrf-validation-using-fetch-post-request
										   // https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
										   // https://www.geeksforgeeks.org/how-to-make-ajax-call-from-javascript/
										   
										   /* $.ajax({

                                               // Our sample url to make request 
                                               url:
                                                  targetURL,

                                               // Type of Request
                                               type: "PUT",
											   contentType: 'application/json',
                                               headers: {
                                                   'X-CSRFToken': '{{csrf_token}}'  // Include CSRF token
                                               },
											   data: JSON.stringify({
                                                   Policy: selectedValues
                                               }),

                                               // Function to call when to
                                               // request is ok 
                                               success: function (data) {
                                                   let x = JSON.stringify(data);
                                                   window.alert("WE are back from Ajax");
												   //window.alert("The data is " + JSON.stringify(data));
												   //window.open(data, '_blank');
                                               },

                                               // Error handling 
                                               error: function (error) {
                                                   console.log(`Error ${error}`);
                                               }
                                            }); */
										   
										   var mode="update"
										   console.log("The selected value is " + selectedValues);
										   if ( selectedValues == "... Create new policy ...." ){
										       mode="create";
										   }
										   
										   if ( selectedValues == "... Create new policy via upload ...." ){
										       mode="create";
										   }
									
										   var targetURL = "/update?policy=" + selectedValues + "&mode=" + mode;	
										   window.open(targetURL,"_blank", "popup")
										   
										   // https://stackoverflow.com/questions/43606056/proper-django-csrf-validation-using-fetch-post-request
										   // https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
										   // https://www.geeksforgeeks.org/how-to-make-ajax-call-from-javascript/
										   
										   return
										   
										   $.ajax({

                                               // Our sample url to make request 
                                               url:
                                                  targetURL,

                                               // Type of Request
                                               type: "GET",
											   contentType: 'application/json',
                                               headers: {
                                                   'X-CSRFToken': '{{csrf_token}}'  // Include CSRF token
                                               },
											   data: JSON.stringify({
                                                   None: ""
                                               }),

                                               // Function to call when to
                                               // request is ok 
                                               success: function (data) {
                                                   let x = JSON.stringify(data);
                                                   window.alert("WE are back from Ajax");
												   //window.alert("The data is " + JSON.stringify(data));
												   //window.open(data, '_blank');
												   // https://stackoverflow.com/questions/62021506/how-to-open-web-page-returned-by-ajax-call
												    //var tab = window.open($("#data").val() + targetURL, $("#data").val() +targetURL);
												   
                                                    //tab.document.write(data); 
                                                    //tab.document.close();
													
													//window.open(targetURL,"_blank", "popup")
													window.open(targetURL, targetURL, "popup")
													
													
												   // const winURL = URL.createObjectURL(new Blob([data], {type:"text/html"}));
												   
												   // const win=window.open(
												   //                      winURL,
													//					 "win",
													//					 'width=800, height=400,screenX=200, screenY=200'
													//					 );
                                               },

                                               // Error handling 
                                               error: function (error) {
                                                   console.log(`Error ${error}`);
                                               }
                                            });
										   
										    
										   
									   }
                                    }
								</script>
								
                                <!-- <p>Disabled Select</p>
                                <select class="form-select" disabled>
                                    <option selected>
                                        Select Profile
                                    </option>
							        {% for SavedPol in SavedPols %}
						            
							        <option value= "{{ SavedPol }}">{{ SavedPol }} </option>
						            {% endfor %}
                            
                                </select> 
						
						        <br>
						        {% for SavedPol in SavedPols %}
						             - {{ SavedPol }}<br>
						        {% endfor %} -->
						    
							</div>
							
						</div>
					
					</body>
					
					<body class="text-center">
                        <div class="container">
                            
							<p>Your current loaded ontologies</p>
							<!-- CM0311 -->
							<p>ODRL_DPV is default ontology    (Green = Public, Blue = Private)</p>
													
                            <div class="container pt-3" style="width:700px;" onclick="ReadSelectedOntol()">
                                <select class="form-select" id="ontology" size="5">					    
						            <option selectedvalue="IGNORE" selected="selected">
                                        Select Ontology
									<option value="... Add new ontology ....">
                                        ... Add new ontology ....
                                    </option>
                                    </option>
							        {% for CustOnt in CustOntList %}
						                <!-- <option value= "{{ SavedPol }}"> </option> -->
							            <option value= "{{ CustOnt.name }}">{{ CustOnt.name }} </option>
						            {% endfor %}
							        
						        </select>
								
								<!-- {% csrf_token %} -->
								
								<script>
								    function ReadSelectedOntol(){
									   
                                       var selectedValues = $("#ontology").val();
									   
                                       if ( selectedValues != "IGNORE" ){
									       
										   const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
										   										   
										   var mode="update"
										   if ( selectedValues == "... Add new ontology ...." ){
										       mode="create"
										   }
									
										   var targetURL = "/update_ontol?ontology=" + selectedValues + "&mode=" + mode;	
										   window.open(targetURL,"_blank", "popup")
										   										   
										   
									   }
                                    }
								</script>
						        						    
							</div>
							
						</div>
					
					</body>
					
					<br>
					
					
					<br>
					
                    <!-- CM2102 No longer required as default ontologies kept in the database -->
					<!-- <body class="text-center">   -->
                    <!--     <div class="container">   -->
                    <!--         -->
					<!-- 		<p>Additional standard ontologies</p>  -->
					<!-- 		   -->
                    <!--         {% for StdOnt in StdOnts %} -->
					<!-- 	        - {{ StdOnt }}<br>   -->
					<!-- 	    {% endfor %}   -->
					<!-- 		-->
					<!-- 	</div>   -->
					
					<!-- </body>	 -->				
																	
					<!-- <div class="text-center text-lg-start">
                        <a href="{% url 'update' %}" class="btn-get-started scrollto d-inline-flex align-items-center justify-content-center align-self-center">
                        <span>Policy Editor</span>
                        <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
					
					
					<div class="text-center text-lg-start">
                        <a href="{% url 'logout' %}" class="btn-get-started scrollto d-inline-flex align-items-center justify-content-center align-self-center">
                        <span>Logout</span>
                        <i class="bi bi-arrow-right"></i>
                        </a>
                    </div> -->
					


               

            </section>
			
			
			<!-- ======= Hero Section ======= -->
            <section id="hero" class="hero d-flex align-items-center">

                <!-- <div class="col-lg-6 hero-img" data-aos="zoom-out" data-aos-delay="200"> -->
                    <!-- <img src="{% static 'img/team-shape.svg' %}" class="img-fluid" alt=""> -->
                <!-- </div> -->
				<!-- <div class="container">
                    <div class="row">
                        <div class="col-lg-6 d-flex flex-column justify-content-center">
                            <div data-aos="fade-up" data-aos-delay="600">
                                <div class="text-center text-lg-start">
                                    <a href="{% url 'update' %}" class="btn-get-started scrollto d-inline-flex align-items-center justify-content-center align-self-center">
                                    <span>Policy Editor</span>
                                    <i class="bi bi-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
				</div> -->
				
				<div class="container">
                    <div class="row">
                        <div class="col-lg-6 d-flex flex-column justify-content-center">
                            <div data-aos="fade-up" data-aos-delay="600">
                                <div class="text-center text-lg-start">
                                    <a href="{% url 'logout' %}" class="btn-get-started scrollto d-inline-flex align-items-center justify-content-center align-self-center">
                                    <span>Logout</span>
                                    <i class="bi bi-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
				</div>
        
            </section><!-- End Hero -->
        </main><!-- End #main -->
		
	
	
  <script type='text/javascript'>
/*  
     var policyMenu=document.getElementById("policy");
	 
	 policyMenu.onchange=function(){
	     var userOption = this.options[this.selectedIndex];
		 window.alert("CLICK FOUND");
		 if ( userOption.value != "IGNORE" ){
		     /* userOption.value 
			 window.alert("CLICK FOUND 2");
			 window.open({% url 'update' %},"UPDATE","");
		 }
		 
	 } */
	 
	 // CM0311 
	 $(document).ready(function () {
	     
		 OntologyList = document.getElementById("ontology").options;
		          
		 // Walk through all the ontologies listed and check public/private
		 for (var j = 0, m = {{CustOntList|safe}}.length;  j < m; j++) { 
		 
			 display_name = {{CustOntList|safe}}[j].name 
			 console.log("Next in ontology list is" + JSON.stringify(display_name))
		     
		     //for (var i = 0, l = OntologyList.childNodes.length; i < l; i++) {
			 for (var i = 0, l = OntologyList.length; i < l; i++) {
			     //console.log("The child node name is " + OntologyList.childNodes[i].nodeName)
				 console.log("The next name is " + OntologyList[i].value)
                 if (OntologyList[i].value === {{CustOntList|safe}}[j].name){
				     if ({{CustOntList|safe}}[j].protection == 0){
					     console.log("Detected a public ontology " + {{CustOntList|safe}}[j].name)
					     //OntologyList[i].className = "active";
						 OntologyList[i].style.backgroundColor = '#90EE90'
				     }
					 else
					 {
					     console.log("Detected a private ontology " + {{CustOntList|safe}}[j].name)
					     //OntologyList[i].className = "private";
						 OntologyList[i].style.backgroundColor = '#6495ED'
					 }
				 }
			 }
		 }
		 
		 PolicyList = document.getElementById("policy").options;
		 
		 // Walk through all the policies listed and check public/private
		 for (var j = 0, m = {{SavedPols|safe}}.length;  j < m; j++) { 
		 
			 display_name = {{SavedPols|safe}}[j].name 
			 console.log("Next in policy list is" + JSON.stringify(display_name))
		     
		     //for (var i = 0, l = OntologyList.childNodes.length; i < l; i++) {
			 for (var i = 0, l = PolicyList.length; i < l; i++) {
			     //console.log("The child node name is " + PolicyList.childNodes[i].nodeName)
				 console.log("The next name is " + PolicyList[i].value)
                 if (PolicyList[i].value === {{SavedPols|safe}}[j].name){
				     if ({{SavedPols|safe}}[j].protection == 0){
					     console.log("Detected a public ontology " + {{SavedPols|safe}}[j].name)
					     //PolicyList[i].className = "active";
						 PolicyList[i].style.backgroundColor = '#90EE90'
				     }
					 else
					 {
					     console.log("Detected a private ontology " + {{SavedPols|safe}}[j].name)
					     //OntologyList[i].className = "private";
						 PolicyList[i].style.backgroundColor = '#6495ED'
					 }
				 }
			 }
		 }
	 });
	
 </script>
 
 {% endblock %}